)]}'
{"version":3,"sources":["meteor://💻app/lib/herald.js","meteor://💻app/lib/helpers.js","meteor://💻app/lib/custom_fields.js","meteor://💻app/lib/notifications.js","meteor://💻app/lib/callbacks.js","meteor://💻app/lib/modules.js","meteor://💻app/lib/routes.js","meteor://💻app/packages/telescope_notifications/package-i18n.js","meteor://💻app/packages/telescope_notifications/lib/client/templates/template.notification_item.js","meteor://💻app/lib/client/templates/notification_item.js","meteor://💻app/packages/telescope_notifications/lib/client/templates/template.notifications_mark_as_read.js","meteor://💻app/lib/client/templates/notifications_mark_as_read.js","meteor://💻app/packages/telescope_notifications/lib/client/templates/template.notification_new_comment.js","meteor://💻app/packages/telescope_notifications/lib/client/templates/template.notification_new_reply.js","meteor://💻app/packages/telescope_notifications/lib/client/templates/template.notification_post_approved.js","meteor://💻app/packages/telescope_notifications/lib/client/templates/template.notifications_menu.js","meteor://💻app/lib/client/templates/notifications_menu.js","meteor://💻app/packages/telescope_notifications/lib/client/templates/template.unsubscribe.js","meteor://💻app/lib/client/templates/unsubscribe.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/ar.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/bg.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/cs.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/da.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/de.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/el.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/en.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/es.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/et.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/fr.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/hu.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/id.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/it.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/ja.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/kk.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/ko.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/nl.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/pl.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/pt-BR.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/ro.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/ru.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/sl.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/sv.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/th.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/tr.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/vi.i18n.js","meteor://💻app/packages/telescope_notifications/packages/telescope_notificationsi18n/zh-CN.i18n.js"],"names":[],"mappings":"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ACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0H;;;;;;;;;;;;;;;;;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH","file":"/packages/telescope_notifications.js","sourcesContent":["// send emails every second when in dev environment\nif (Meteor.absoluteUrl().indexOf('localhost') !== -1)\n  Herald.settings.queueTimer = 1000;\n\nMeteor.startup(function () {\n\n  Herald.collection.deny({\n    update: function(){ return !Users.can.editById; },\n    remove: function(){ return !Users.can.editById; }\n  });\n\n  // disable all email notifications when \"emailNotifications\" is set to false\n  Herald.settings.overrides.email = !Settings.get('emailNotifications', true);\n\n});\n","/**\n * Use user and post properties to populate post notifications objects.\n * @param {Object} post\n */\nPosts.getNotificationProperties = function (post) {\n  var postAuthor = Meteor.users.findOne(post.userId);\n  var properties = {\n    postAuthorName : Posts.getAuthorName(post),\n    postTitle : Telescope.utils.cleanUp(post.title),\n    profileUrl: Users.getProfileUrl(postAuthor, true),\n    postUrl: Posts.getPageUrl(post, true),\n    thumbnailUrl: post.thumbnailUrl,\n    linkUrl: !!post.url ? Telescope.utils.getOutgoingUrl(post.url) : Posts.getPageUrl(post, true)\n  };\n\n  if(post.url)\n    properties.url = post.url;\n\n  if(post.htmlBody)\n    properties.htmlBody = post.htmlBody;\n\n  return properties;\n};\n\n/**\n * Use comment, user, and post properties to populate comment notifications objects.\n * @param {Object} comment\n */\nComments.getNotificationProperties = function (comment, post) {\n  var commentAuthor = Meteor.users.findOne(comment.userId);\n  var properties = {\n    profileUrl: commentAuthor && commentAuthor.getProfileUrl(true),\n    postUrl: Posts.getPageUrl(post, true),\n    authorName : Comments.getAuthorName(comment),\n    postTitle: post.title,\n    htmlBody: comment.htmlBody,\n    commentUrl: Comments.getPageUrl(comment, true)\n  };\n  return properties;\n};\n","Settings.addField({\n  fieldName: 'emailNotifications',\n  fieldSchema: {\n    type: Boolean,\n    optional: true,\n    defaultValue: true,\n    autoform: {\n      group: 'notifications',\n      instructions: 'Enable email notifications for new posts and new comments (requires restart).'\n    }\n  }\n});\n\n// make it possible to disable notifications on a per-comment basis\nComments.addField(\n  {\n    fieldName: 'disableNotifications',\n    fieldSchema: {\n      type: Boolean,\n      optional: true,\n      autoform: {\n        omit: true\n      }\n    }\n  }\n);\n\n// Add notifications options to user profile settings\nUsers.addField([\n  {\n    fieldName: 'telescope.notifications.users',\n    fieldSchema: {\n      label: 'New users',\n      type: Boolean,\n      optional: true,\n      defaultValue: false,\n      editableBy: ['admin'],\n      autoform: {\n        group: 'Email Notifications'\n      }\n    }\n  },\n  {\n    fieldName: 'telescope.notifications.posts',\n    fieldSchema: {\n      label: 'New posts',\n      type: Boolean,\n      optional: true,\n      defaultValue: false,\n      editableBy: ['admin', 'member'],\n      autoform: {\n        group: 'Email Notifications'\n      }\n    }\n  },\n  {\n    fieldName: 'telescope.notifications.comments',\n    fieldSchema: {\n      label: 'Comments on my posts',\n      type: Boolean,\n      optional: true,\n      defaultValue: true,\n      editableBy: ['admin', 'member'],\n      autoform: {\n        group: 'Email Notifications'\n      }\n    }\n  },\n  {\n    fieldName: 'telescope.notifications.replies',\n    fieldSchema: {\n      label: 'Replies to my comments',\n      type: Boolean,\n      optional: true,\n      defaultValue: true,\n      editableBy: ['admin', 'member'],\n      autoform: {\n        group: 'Email Notifications'\n      }\n    }\n  }\n]);\n","var notifications = {\n\n  newPost: {\n    properties: function () {\n      return Posts.getNotificationProperties(this.data.post);\n    },\n    subject: function () {\n      return this.postAuthorName+' has created a new post: '+this.postTitle;\n    },\n    emailTemplate: \"emailNewPost\"\n  },\n\n  newPendingPost: {\n    properties: function () {\n      return Posts.getNotificationProperties(this.data.post);\n    },\n    subject: function () {\n      return this.postAuthorName+' has a new post pending approval: '+this.postTitle;\n    },\n    emailTemplate: \"emailNewPendingPost\"\n  },\n\n  postApproved: {\n    properties: function () {\n      return Posts.getNotificationProperties(this.data.post);\n    },\n    subject: function () {\n      return 'Your post “'+this.postTitle+'” has been approved';\n    },\n    emailTemplate: \"emailPostApproved\",\n    onsiteTemplate: \"notification_post_approved\"\n  },\n\n  newComment: {\n    properties: function () {\n      return Comments.getNotificationProperties(this.data.comment, this.data.post);\n    },\n    subject: function () {\n      return this.authorName+' left a new comment on your post \"' + this.postTitle + '\"';\n    },\n    emailTemplate: \"emailNewComment\",\n    onsiteTemplate: \"notification_new_comment\"\n  },\n\n  newReply: {\n    properties: function () {\n      return Comments.getNotificationProperties(this.data.comment, this.data.post);\n    },\n    subject: function () {\n      return this.authorName+' replied to your comment on \"'+this.postTitle+'\"';\n    },\n    emailTemplate: \"emailNewReply\",\n    onsiteTemplate: \"notification_new_reply\"\n  },\n\n  newCommentSubscribed: {\n    properties: function () {\n      return Comments.getNotificationProperties(this.data.comment, this.data.post);\n    },\n    subject: function () {\n      return this.authorName+' left a new comment on \"' + this.postTitle + '\"';\n    },\n    emailTemplate: \"notification_new_comment\",\n    onsite: \"notification_new_comment\"\n  }\n\n};\n\n// set up couriers\n_.each(notifications, function (notification, notificationName) {\n\n  var courier = {\n    media: {\n      email: {\n        emailRunner: function (user) {\n          var properties = notification.properties.call(this);\n          var subject = notification.subject.call(properties);\n          var html = Telescope.email.buildTemplate(Telescope.email.getTemplate(notification.emailTemplate)(properties));\n          Telescope.email.send(Users.getEmail(user), subject, html);\n        }\n      }\n    }\n  };\n\n  if (!!notification.onsiteTemplate) {\n    courier.media.onsite = {};\n    courier.message = function () {\n      var properties = notification.properties.call(this);\n      return Blaze.toHTML(Blaze.With(properties, function () {\n        return Template[notification.onsiteTemplate];\n      }));\n    };\n  }\n\n  Herald.addCourier(notificationName, courier);\n\n});","// ------------------------------------------------------------------------------------------- //\n// -----------------------------------------  Posts ------------------------------------------ //\n// ------------------------------------------------------------------------------------------- //\n\n// add new post notification callback on post submit\nfunction postSubmitNotification (post) {\n\n  var adminIds = _.pluck(Users.adminUsers({fields: {_id:1}}), '_id');\n  var notifiedUserIds = _.pluck(Users.find({'telescope.notifications.posts': true}, {fields: {_id:1}}).fetch(), '_id');\n  var notificationData = {\n    post: _.pick(post, '_id', 'userId', 'title', 'url')\n  };\n\n  // remove post author ID from arrays\n  adminIds = _.without(adminIds, post.userId);\n  notifiedUserIds = _.without(notifiedUserIds, post.userId);\n\n  if (post.status === Posts.config.STATUS_PENDING && !!adminIds.length) {\n    // if post is pending, only notify admins\n    Herald.createNotification(adminIds, {courier: 'newPendingPost', data: notificationData});\n  } else if (!!notifiedUserIds.length) {\n    // if post is approved, notify everybody\n    Herald.createNotification(notifiedUserIds, {courier: 'newPost', data: notificationData});\n  }\n\n}\nTelescope.callbacks.add(\"postSubmitAsync\", postSubmitNotification);\n\nfunction postApprovedNotification (post) {\n\n  var notificationData = {\n    post: _.pick(post, '_id', 'userId', 'title', 'url')\n  };\n\n  Herald.createNotification(post.userId, {courier: 'postApproved', data: notificationData});\n}\nTelescope.callbacks.add(\"postApproveAsync\", postApprovedNotification);\n\n// ------------------------------------------------------------------------------------------- //\n// ---------------------------------------- Comments ----------------------------------------- //\n// ------------------------------------------------------------------------------------------- //\n\n// add new comment notification callback on comment submit\nfunction commentSubmitNotifications (comment) {\n\n  // note: dummy content has disableNotifications set to true\n  if(Meteor.isServer && !comment.disableNotifications){\n\n    var post = Posts.findOne(comment.postId),\n        postAuthor = Users.findOne(post.userId),\n        userIdsNotified = [],\n        notificationData = {\n          comment: _.pick(comment, '_id', 'userId', 'author', 'htmlBody'),\n          post: _.pick(post, '_id', 'userId', 'title', 'url')\n        };\n\n\n    // 1. Notify author of post (if they have new comment notifications turned on)\n    //    but do not notify author of post if they're the ones posting the comment\n    if (Users.getSetting(postAuthor, \"notifications.comments\", true) && comment.userId !== postAuthor._id) {\n      Herald.createNotification(post.userId, {courier: 'newComment', data: notificationData});\n      userIdsNotified.push(post.userId);\n    }\n\n    // 2. Notify author of comment being replied to\n    if (!!comment.parentCommentId) {\n\n      var parentComment = Comments.findOne(comment.parentCommentId);\n\n      // do not notify author of parent comment if they're also post author or comment author\n      // (someone could be replying to their own comment)\n      if (parentComment.userId !== post.userId && parentComment.userId !== comment.userId) {\n\n        var parentCommentAuthor = Users.findOne(parentComment.userId);\n\n        // do not notify parent comment author if they have reply notifications turned off\n        if (Users.getSetting(parentCommentAuthor, \"notifications.replies\", true)) {\n\n          // add parent comment to notification data\n          notificationData.parentComment = _.pick(parentComment, '_id', 'userId', 'author', 'htmlBody');\n\n          Herald.createNotification(parentComment.userId, {courier: 'newReply', data: notificationData});\n          userIdsNotified.push(parentComment.userId);\n        }\n      }\n\n    }\n\n    // 3. Notify users subscribed to the thread\n    // TODO: ideally this would be injected from the telescope-subscribe-to-posts package\n    if (!!post.subscribers) {\n\n      // remove userIds of users that have already been notified\n      // and of comment author (they could be replying in a thread they're subscribed to)\n      var subscriberIdsToNotify = _.difference(post.subscribers, userIdsNotified, [comment.userId]);\n      Herald.createNotification(subscriberIdsToNotify, {courier: 'newCommentSubscribed', data: notificationData});\n\n      userIdsNotified = userIdsNotified.concat(subscriberIdsToNotify);\n\n    }\n\n  }\n}\nTelescope.callbacks.add(\"commentSubmitAsync\", commentSubmitNotifications);\n","Telescope.modules.add(\"secondaryNav\", {\n  template:'notifications_menu',\n  order: 20\n});\n\nTelescope.modules.add(\"mobileNav\", {\n  template:'notifications_menu',\n  order: 20\n});","FlowRouter.route('/unsubscribe/:hash', {\n  name: \"unsubscribe\",\n  action: function(params, queryParams) {\n    Meteor.logout();\n    BlazeLayout.render(\"layout\", {main: \"unsubscribe\"});\n  }\n});","TAPi18n.packages[\"telescope:notifications\"] = {\"translation_function_name\":\"__\",\"helper_name\":\"_\",\"namespace\":\"project\"};\n\n// define package's translation function (proxy to the i18next)\n__ = TAPi18n._getPackageI18nextProxy(\"project\");\n// define the package's templates registrar\nregisterI18nTemplate = TAPi18n._getRegisterHelpersProxy(\"telescope:notifications\");\nregisterTemplate = registerI18nTemplate; // XXX OBSOLETE, kept for backward compatibility will be removed in the future\n\n// Record the list of templates prior to package load\nvar _ = Package.underscore._;\nnon_package_templates = _.keys(Template);\n","\nTemplate.__checkName(\"notification_item\");\nTemplate[\"notification_item\"] = new Template(\"Template.notification_item\", (function() {\n  var view = this;\n  return HTML.DIV({\n    \"class\": function() {\n      return Blaze.If(function() {\n        return Spacebars.call(Spacebars.dot(view.lookup(\"item\"), \"data\", \"read\"));\n      }, function() {\n        return \"read\";\n      });\n    }\n  }, \"\\n    \", HTML.SPAN({\n    \"class\": \"notification-timestamp\"\n  }, Blaze.View(\"lookup:timeAgo\", function() {\n    return Spacebars.mustache(view.lookup(\"timeAgo\"), Spacebars.dot(view.lookup(\"item\"), \"data\", \"timestamp\"));\n  }), \":\"), \"\\n    \", HTML.DIV({\n    \"class\": \"notification-html\"\n  }, \"\\n      \", Blaze.View(\"lookup:notificationHTML\", function() {\n    return Spacebars.makeRaw(Spacebars.mustache(view.lookup(\"notificationHTML\")));\n  }), \"\\n    \"), \"\\n  \");\n}));\n","Template.notification_item.helpers({\n  properties: function(){\n    return this.data;\n  },\n  notificationHTML: function(){\n    return this.item.data.message();\n  }\n});\n\nTemplate.notification_item.events({\n  'click .action-link': function(event, instance){\n    var notificationId=instance.data._id;\n    Herald.collection.update(\n    {_id: notificationId},\n    {\n      $set:{\n        read: true\n      }\n    },\n    function(error, result){\n      if(error){\n        console.log(error);\n      } \n    }\n  );  \n  }\n});\n","\nTemplate.__checkName(\"notifications_mark_as_read\");\nTemplate[\"notifications_mark_as_read\"] = new Template(\"Template.notifications_mark_as_read\", (function() {\n  var view = this;\n  return HTML.A({\n    href: \"#\",\n    \"class\": \"button mark-as-read btn btn-primary\"\n  }, Blaze.View(\"lookup:_\", function() {\n    return Spacebars.mustache(view.lookup(\"_\"), \"mark_as_read\");\n  }));\n}));\n","Template.notifications_mark_as_read.events({\n  'click .mark-as-read': function(e, t){\n    e.preventDefault();\n    t.$('li').parents('.dropdown').removeClass('dropdown-open');\n    Meteor.call('heraldMarkAllAsRead', \n      function(error, result){\n        error && console.log(error);\n      }\n    );\n  }\n});\n","\nTemplate.__checkName(\"notification_new_comment\");\nTemplate[\"notification_new_comment\"] = new Template(\"Template.notification_new_comment\", (function() {\n  var view = this;\n  return HTML.P(\"\\n    \", HTML.A({\n    href: function() {\n      return Spacebars.mustache(view.lookup(\"profileUrl\"));\n    }\n  }, Blaze.View(\"lookup:authorName\", function() {\n    return Spacebars.mustache(view.lookup(\"authorName\"));\n  })), \" \\n    \", Blaze.View(\"lookup:_\", function() {\n    return Spacebars.mustache(view.lookup(\"_\"), \"left_a_new_comment_on\");\n  }), \"  \\n    \", HTML.A({\n    href: function() {\n      return Spacebars.mustache(view.lookup(\"commentUrl\"));\n    },\n    \"class\": \"action-link\"\n  }, Blaze.View(\"lookup:postTitle\", function() {\n    return Spacebars.mustache(view.lookup(\"postTitle\"));\n  })), \"\\n  \");\n}));\n","\nTemplate.__checkName(\"notification_new_reply\");\nTemplate[\"notification_new_reply\"] = new Template(\"Template.notification_new_reply\", (function() {\n  var view = this;\n  return HTML.P(\"\\n    \", HTML.A({\n    href: function() {\n      return Spacebars.mustache(view.lookup(\"profileUrl\"));\n    }\n  }, Blaze.View(\"lookup:authorName\", function() {\n    return Spacebars.mustache(view.lookup(\"authorName\"));\n  })), \"\\n    \", Blaze.View(\"lookup:_\", function() {\n    return Spacebars.mustache(view.lookup(\"_\"), \"has_replied_to_your_comment_on\");\n  }), \" \\n    \", HTML.A({\n    href: function() {\n      return Spacebars.mustache(view.lookup(\"commentUrl\"));\n    },\n    \"class\": \"action-link\"\n  }, Blaze.View(\"lookup:postTitle\", function() {\n    return Spacebars.mustache(view.lookup(\"postTitle\"));\n  })), \"\\n  \");\n}));\n","\nTemplate.__checkName(\"notification_post_approved\");\nTemplate[\"notification_post_approved\"] = new Template(\"Template.notification_post_approved\", (function() {\n  var view = this;\n  return HTML.P(\"\\n    \", Blaze.View(\"lookup:_\", function() {\n    return Spacebars.mustache(view.lookup(\"_\"), \"your_post\");\n  }), \" \\n    \", HTML.A({\n    href: function() {\n      return Spacebars.mustache(view.lookup(\"postUrl\"));\n    },\n    \"class\": \"action-link\"\n  }, Blaze.View(\"lookup:postTitle\", function() {\n    return Spacebars.mustache(view.lookup(\"postTitle\"));\n  })), \"\\n    \", Blaze.View(\"lookup:_\", function() {\n    return Spacebars.mustache(view.lookup(\"_\"), \"has_been_approved\");\n  }), \" \\n  \");\n}));\n","\nTemplate.__checkName(\"notifications_menu\");\nTemplate[\"notifications_menu\"] = new Template(\"Template.notifications_menu\", (function() {\n  var view = this;\n  return Blaze.If(function() {\n    return Spacebars.call(view.lookup(\"isLoggedIn\"));\n  }, function() {\n    return [ \"\\n      \", HTML.DIV({\n      \"class\": function() {\n        return [ \"notifications-menu-wrapper \", Spacebars.mustache(view.lookup(\"moduleClass\")) ];\n      }\n    }, \"\\n        \", Blaze._TemplateWith(function() {\n      return {\n        menuName: Spacebars.call(\"notifications\"),\n        menuLabel: Spacebars.call(view.lookup(\"menuLabel\")),\n        menuItems: Spacebars.call(view.lookup(\"menuItems\")),\n        menuType: Spacebars.call(view.lookup(\"menuType\")),\n        expandLevel: Spacebars.call(0)\n      };\n    }, function() {\n      return Spacebars.include(view.lookupTemplate(\"menuComponent\"));\n    }), \"\\n      \"), \"\\n    \" ];\n  });\n}));\n","var getNotifications = function () {\n  return Herald.collection.find({userId: Meteor.userId(), read: false}, {sort: {timestamp: -1}}).fetch();\n};\n\nTemplate.notifications_menu.helpers({\n  hasNotifications: function () {\n    var notifications = getNotifications();\n    return notifications.length;\n  },\n  menuLabel: function () {\n    var notificationsCount;\n    var notifications = getNotifications();\n\n    if(notifications.length === 0){\n      notificationsCount = i18n.t('no_notifications');\n    }else if(notifications.length === 1){\n      notificationsCount = i18n.t('1_notification');\n    }else{\n      notificationsCount = notifications.length+' '+ i18n.t('notifications');\n    }\n\n    return notificationsCount;\n  },\n  menuItems: function () {\n    var notifications = getNotifications();\n    var markAllAsRead = [{\n      template: 'notifications_mark_as_read'\n    }];\n    var menuItems;\n    if (notifications.length) {\n      menuItems = markAllAsRead.concat(_.map(notifications, function (notification) {\n        return {\n          template: \"notification_item\",\n          data: notification\n        };\n      }));\n    } else {\n      menuItems = [];\n    }\n    return menuItems;\n  },\n  menuType: function () {\n    if (this.zone === \"mobileNav\") {\n      return 'collapsible';\n    } else if (Settings.get('navLayout', 'top-nav') === 'top-nav') {\n      return 'dropdown';\n    } else {\n      return 'collapsible';\n    }\n  }\n});\n","\nTemplate.__checkName(\"unsubscribe\");\nTemplate[\"unsubscribe\"] = new Template(\"Template.unsubscribe\", (function() {\n  var view = this;\n  return HTML.DIV({\n    \"class\": \"grid-small grid-block dialog admin\"\n  }, \"\\n    \", HTML.P(Blaze.View(\"lookup:unsubscribed\", function() {\n    return Spacebars.mustache(view.lookup(\"unsubscribed\"));\n  })), \"\\n  \");\n}));\n","Template.unsubscribe.created = function(){\n  var hash = FlowRouter.getParam(\"hash\");\n  Meteor.call('unsubscribeUser', hash, function(error, result){\n    if(result){\n      Session.set('unsubscribedMessage', __('you_have_been_unsubscribed_from_all_notifications'));\n    }else{\n      Session.set('unsubscribedMessage', __('user_not_found'));\n    }\n  });\n  Events.track('notificationsUnsubcribe', {hash: hash});\n};\n\nTemplate.unsubscribe.helpers({\n  unsubscribed : function(){\n    // we have to use a session variable because the string we want to display\n    // depends on the return value of an asynchronous callback (unsubscribeUser)\n    return Session.get('unsubscribedMessage');\n  }\n});","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nvar package_templates = _.difference(_.keys(Template), non_package_templates);\n\nfor (var i = 0; i < package_templates.length; i++) {\n  var package_template = package_templates[i];\n\n  registerI18nTemplate(package_template);\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n// integrate the fallback language translations \ntranslations = {};\ntranslations[namespace] = {\"a_new_comment_on_your_post\":\"A new comment on your post\",\"you_have_a_new_comment_by\":\"You have a new comment by \",\"on_your_post\":\" on your post\",\"has_created_a_new_post\":\" has created a new post\",\"someone_replied_to_your_comment_on\":\"Someone replied to your comment on\",\"no_notifications\":\"No notifications\",\"1_notification\":\"1 notification\",\"notifications\":\"notifications\",\"mark_all_as_read\":\"Mark all as read\",\"left_a_new_comment_on\":\"left a new comment on\",\"has_replied_to_your_comment_on\":\"has replied to your comment on\",\"mark_as_read\":\"Mark as read\",\"you_have_been_unsubscribed_from_all_notifications\":\"You have been unsubscribed from all notifications.\",\"user_not_found\":\"User not found\",\"notifications_fieldset\":\"Notifications\",\"emailNotifications\":\"Email Notifications\",\"your_post\":\"Your post\",\"has_been_approved\":\"has been approved\"};\nTAPi18n._loadLangFileObject(\"en\", translations);\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope:notifications\",\n    namespace = \"telescope:notifications\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n"]}