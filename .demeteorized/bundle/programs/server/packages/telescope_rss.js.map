{"version":3,"sources":["meteor://ðŸ’»app/lib/server/rss.js","meteor://ðŸ’»app/lib/server/routes.js"],"names":[],"mappings":"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","file":"/packages/telescope_rss.js","sourcesContent":["RSS = Npm.require('rss');\n\ngetMeta = function (url) {\n  var siteUrl = Settings.get('siteUrl', Meteor.absoluteUrl());\n  return {\n    title: Settings.get('title'),\n    description: Settings.get('tagline'),\n    feed_url: siteUrl+url,\n    site_url: siteUrl,\n    image_url: siteUrl+'img/favicon.png'\n  };\n};\n\nservePostRSS = function (terms, url) {\n  var feed = new RSS(getMeta(url));\n\n  var params = Posts.parameters.get(terms);\n  delete params['options']['sort']['sticky'];\n\n  Posts.find(params.find, params.options).forEach(function(post) {\n\n    var description = !!post.body ? post.body+'</br></br>' : '';\n    var feedItem = {\n      title: post.title,\n      description: description + '<a href=\"' + post.getPageUrl(true) + '\">Discuss</a>',\n      author: post.author,\n      date: post.postedAt,\n      guid: post._id,\n      url: Posts.getShareableLink(post)\n    };\n\n    if (post.thumbnailUrl) {\n      var url = Telescope.utils.addHttp(post.thumbnailUrl);\n      feedItem.custom_elements = [{\"imageUrl\":url}, {\"content\": url}];\n    }\n\n    feed.item(feedItem);\n  });\n\n  return feed.xml();\n};\n\nserveCommentRSS = function (terms, url) {\n  var feed = new RSS(getMeta(url));\n\n  Comments.find({isDeleted: {$ne: true}}, {sort: {postedAt: -1}, limit: 20}).forEach(function(comment) {\n    post = Posts.findOne(comment.postId);\n    feed.item({\n     title: 'Comment on '+post.title,\n     description: comment.body+'</br></br>'+'<a href=\"'+Telescope.utils.getPostCommentUrl(post._id, comment._id)+'\">Discuss</a>',\n     author: comment.author,\n     date: comment.postedAt,\n     url: comment.getPageUrl(true),\n     guid: comment._id\n    });\n  });\n\n  return feed.xml();\n};\n","Picker.route('/feed.xml', function(params, req, res, next) {\n  if (typeof params.query.view === \"undefined\") {\n    params.query.view = 'new';\n  }\n  res.end(servePostRSS(params.query, 'feed.xml'));\n});\n\nPicker.route('/rss/posts/new.xml', function(params, req, res, next) {\n  res.end(servePostRSS({view: 'new'}, '/rss/posts/new.xml'));\n});\n\nPicker.route('/rss/posts/top.xml', function(params, req, res, next) {\n  res.end(servePostRSS({view: 'top'}, '/rss/posts/top.xml'));\n});\n\nPicker.route('/rss/posts/best.xml', function(params, req, res, next) {\n  res.end(servePostRSS({view: 'best'}, '/rss/posts/best.xml'));\n});\n\nPicker.route('/rss/category/:slug/feed.xml', function(params, req, res, next) {\n  res.end(servePostRSS({view: 'new', cat: params.slug}, '/rss/category/:slug/feed.xml'));\n});\n\nPicker.route('/rss/comments.xml', function(params, req, res, next) {\n  res.end(serveCommentRSS({}, '/rss/comments.xml'));\n});\n"]}