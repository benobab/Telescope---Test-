{"version":3,"sources":["meteor://ðŸ’»app/lib/server/api.js","meteor://ðŸ’»app/lib/server/routes.js"],"names":[],"mappings":"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","file":"/packages/telescope_api.js","sourcesContent":["serveAPI = function(terms){\n  var posts = [];\n\n  var parameters = Posts.parameters.get(terms);\n\n  Posts.find(parameters.find, parameters.options).forEach(function(post) {\n    var url = Posts.getLink(post);\n    var postOutput = {\n      title: post.title,\n      headline: post.title, // for backwards compatibility\n      author: post.author,\n      date: post.postedAt,\n      url: url,\n      pageUrl: Posts.getPageUrl(post, true),\n      guid: post._id\n    };\n\n    if(post.body)\n      postOutput.body = post.body;\n\n    if(post.url)\n      postOutput.domain = Telescope.utils.getDomain(url);\n\n    if (post.thumbnailUrl) {\n      postOutput.thumbnailUrl = Telescope.utils.addHttp(post.thumbnailUrl);\n    }\n\n    var twitterName = Users.getTwitterNameById(post.userId);\n    if(twitterName)\n      postOutput.twitterName = twitterName;\n\n    var comments = [];\n\n    Comments.find({postId: post._id}, {sort: {postedAt: -1}, limit: 50}).forEach(function(comment) {\n      var commentProperties = {\n       body: comment.body,\n       author: comment.author,\n       date: comment.postedAt,\n       guid: comment._id,\n       parentCommentId: comment.parentCommentId\n      };\n      comments.push(commentProperties);\n    });\n\n    var commentsToDelete = [];\n\n    comments.forEach(function(comment, index) {\n      if (comment.parentCommentId) {\n        var parent = comments.filter(function(obj) {\n          return obj.guid === comment.parentCommentId;\n        })[0];\n        if (parent) {\n          parent.replies = parent.replies || [];\n          parent.replies.push(JSON.parse(JSON.stringify(comment)));\n          commentsToDelete.push(index);\n        }\n      }\n    });\n\n    commentsToDelete.reverse().forEach(function(index) {\n      comments.splice(index,1);\n    });\n\n    postOutput.comments = comments;\n\n    posts.push(postOutput);\n  });\n\n  return JSON.stringify(posts);\n};\n","// for backwards compatibility's sake, accept a \"limit\" segment\nPicker.route('/api/:limit?', function(params, req, res, next) {\n  if (typeof params.limit !== \"undefined\") {\n    params.query.limit = params.limit;\n  }\n  res.end(serveAPI(params.query));\n});"]}