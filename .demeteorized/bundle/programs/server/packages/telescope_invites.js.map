{"version":3,"sources":["meteor://üíªapp/packages/telescope_invites/package-i18n.js","meteor://üíªapp/lib/invites.js","meteor://üíªapp/lib/server/invites.js","meteor://üíªapp/lib/server/publications.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/ar.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/bg.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/cs.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/da.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/de.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/el.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/en.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/es.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/et.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/fr.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/hu.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/id.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/it.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/ja.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/kk.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/ko.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/nl.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/pl.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/pt-BR.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/ro.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/ru.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/sl.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/sv.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/th.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/tr.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/vi.i18n.js","meteor://üíªapp/packages/telescope_invites/packages/telescope_invitesi18n/zh-CN.i18n.js"],"names":[],"mappings":"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rE;CACF,CAAC,CAAC,mH;;;;;;;;;;;;;;;;;;ACvFH,MAAM,CAAC,OAAO,CAAC,SAAS,EAAE,UAAU,MAAM,EAAE;AAC1C,MAAI,OAAO,GAAG,OAAO,CAAC,IAAI,CAAC,EAAC,cAAc,EAAE,MAAM,EAAC,CAAC,CAAC;AACrD,SAAQ,IAAI,CAAC,MAAM,KAAK,MAAM,IAAI,KAAK,CAAC,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,GAAI,OAAO,GAAG,EAAE,CAAC;CACnF,CAAC,CAAC,mH;;;;;;;;;;;;;;;;;;ACHH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH","file":"/packages/telescope_invites.js","sourcesContent":["TAPi18n.packages[\"telescope:invites\"] = {\"translation_function_name\":\"__\",\"helper_name\":\"_\",\"namespace\":\"project\"};\n\n// define package's translation function (proxy to the i18next)\n__ = TAPi18n._getPackageI18nextProxy(\"project\");\n","var InviteSchema = new SimpleSchema({\n  _id: {\n    type: String,\n    optional: true\n  },\n  invitingUserId: {\n    type: String,\n    optional: true\n  },\n  invitedUserEmail: {\n    type: String,\n    regEx: SimpleSchema.RegEx.Email\n  },\n  accepted: {\n    type: Boolean,\n    optional: true\n  }\n});\n\nInvites = new Meteor.Collection(\"invites\");\nInvites.attachSchema(InviteSchema);\n\nUsers.addField([\n  /**\n    A count of the user's remaining invites\n  */\n  {\n    fieldName: \"telescope.inviteCount\",\n    fieldSchema: {\n      type: Number,\n      optional: true\n    }\n  },\n  /**\n    A count of how many users have been invited by the user\n  */\n  {\n    fieldName: \"telescope.invitedCount\",\n    fieldSchema: {\n      type: Number,\n      optional: true\n    }\n  },\n  /**\n    Whether the user is invited or not\n  */\n  {\n    fieldName: \"telescope.isInvited\",\n    fieldSchema: {\n      type: Boolean,\n      public: true,\n      optional: true,\n      editableBy: [\"admin\"],\n      autoform: {\n        omit: true\n      }\n    }\n  },\n  /**\n    The _id of the user who invited the current user\n  */\n  {\n    fieldName: \"telescope.invitedBy\",\n    fieldSchema: {\n      type: String,\n      optional: true,\n      autoform: {\n        omit: true\n      }\n    }\n  },\n  /**\n    The name of the user who invited the current user\n  */\n  {\n    fieldName: \"telescope.invitedByName\",\n    fieldSchema: {\n      type: String,\n      optional: true,\n      autoform: {\n        omit: true\n      }\n    }\n  }\n]);\n\n// invites are managed through Meteor method\n\nInvites.deny({\n  insert: function(){ return true; },\n  update: function(){ return true; },\n  remove: function(){ return true; }\n});\n\nTelescope.modules.add(\"profileEdit\", {\n  template: 'user_invites',\n  order: 2\n});\n\n function setStartingInvites (user) {\n  // give new users a few invites (default to 3)\n  user.telescope.inviteCount = Settings.get('startInvitesCount', 3);\n  return user;\n}\nTelescope.callbacks.add(\"onCreateUser\", setStartingInvites);\n\n// on profile completion, check if the new user has been invited\n// if so set her status accordingly and update invitation info\nfunction checkIfInvited (user) {\n\n  var invite = Invites.findOne({ invitedUserEmail : Users.getEmail(user) });\n\n  if(invite){\n\n    var invitedBy = Meteor.users.findOne({ _id : invite.invitingUserId });\n\n    Users.update(user._id, { $set: {\n      \"telescope.isInvited\": true,\n      \"telescope.invitedBy\": invitedBy._id,\n      \"telescope.invitedByName\": Users.getDisplayName(invitedBy)\n    }});\n\n    Invites.update(invite._id, {$set : {\n      accepted : true\n    }});\n\n  }\n}\nTelescope.callbacks.add(\"profileCompletedAsync\", checkIfInvited);\n","Meteor.methods({\n\n  inviteUser: function(invitation){\n\n    check(invitation, Match.Any);\n    \n    // invite user returns the following hash\n    // { newUser : true|false }\n    // newUser is true if the person being invited is not on the site yet\n\n    // invitation can either contain userId or an email address :\n    // { invitedUserEmail : 'bob@gmail.com' } or { userId : 'user-id' }\n\n    check(invitation, Match.OneOf(\n      { invitedUserEmail : String },\n      { userId : String }\n    ));\n\n    var user = invitation.invitedUserEmail ?\n          Meteor.users.findOne({ emails : { $elemMatch: { address: invitation.invitedUserEmail } } }) :\n          Meteor.users.findOne({ _id : invitation.userId });\n    \n    var userEmail = invitation.invitedUserEmail ? invitation.invitedUserEmail :Users.getEmail(user);\n    var currentUser = Meteor.user();\n    var currentUserIsAdmin = Users.is.admin(currentUser);\n    var currentUserCanInvite = currentUserIsAdmin || (currentUser.telescope.inviteCount > 0 && Users.can.invite(currentUser));\n\n    // check if the person is already invited\n    if(user && Users.is.invited(user)){\n      throw new Meteor.Error(403, \"This person is already invited.\");\n    } else {\n      if (!currentUserCanInvite){\n        throw new Meteor.Error(701, \"You can't invite this user, sorry.\");\n      }\n\n      // don't allow duplicate multiple invite for the same person\n      var existingInvite = Invites.findOne({ invitedUserEmail : userEmail });\n\n      if (existingInvite) {\n        throw new Meteor.Error(403, \"Somebody has already invited this person.\");\n      }\n\n      // create an invite\n      // consider invite accepted if the invited person has an account already\n      Invites.insert({\n        invitingUserId: Meteor.userId(),\n        invitedUserEmail: userEmail,\n        accepted: typeof user !== \"undefined\"\n      });\n\n      // update invinting user\n      Meteor.users.update(Meteor.userId(), {$inc:{\"telescope.inviteCount\": -1, \"telescope.invitedCount\": 1}});\n\n      if(user){\n        // update invited user\n        Meteor.users.update(user._id, {\n          $set: {\n            \"telescope.isInvited\": true,\n            \"telescope.invitedBy\": Meteor.userId(),\n            \"telescope.invitedByName\": Users.getDisplayName(currentUser)\n          }\n        });\n      }\n\n      var communityName = Settings.get('title','Telescope'),\n          emailSubject = 'You are invited to try '+communityName,\n          emailProperties = {\n            newUser : typeof user === 'undefined',\n            communityName : communityName,\n            actionLink : user ? Telescope.utils.getSigninUrl() : Telescope.utils.getSignupUrl(),\n            invitedBy : Users.getDisplayName(currentUser),\n            profileUrl : Users.getProfileUrl(currentUser)\n          };\n\n      Meteor.setTimeout(function () {\n        Telescope.email.buildAndSend(userEmail, emailSubject, 'emailInvite', emailProperties);\n      }, 1);\n\n    }\n\n    return {\n      newUser : typeof user === 'undefined'\n    };\n  },\n  unInviteUser: function (userId) {\n    Meteor.users.update(userId, {$set: {\"telescope.isInvited\": false}});\n  }\n});\n","Meteor.publish('invites', function (userId) {\n  var invites = Invites.find({invitingUserId: userId});\n  return (this.userId === userId || Users.is.adminById(this.userId)) ? invites : [];\n});\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"ar\"])) {\n  TAPi18n.translations[\"ar\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"ar\"][namespace])) {\n  TAPi18n.translations[\"ar\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"ar\"][namespace], {});\nTAPi18n._registerServerTranslator(\"ar\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"bg\"])) {\n  TAPi18n.translations[\"bg\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"bg\"][namespace])) {\n  TAPi18n.translations[\"bg\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"bg\"][namespace], {});\nTAPi18n._registerServerTranslator(\"bg\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"cs\"])) {\n  TAPi18n.translations[\"cs\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"cs\"][namespace])) {\n  TAPi18n.translations[\"cs\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"cs\"][namespace], {\"translation_key\":\"Promƒõnn√° p≈ôekladu\"});\nTAPi18n._registerServerTranslator(\"cs\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"da\"])) {\n  TAPi18n.translations[\"da\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"da\"][namespace])) {\n  TAPi18n.translations[\"da\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"da\"][namespace], {});\nTAPi18n._registerServerTranslator(\"da\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"de\"])) {\n  TAPi18n.translations[\"de\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"de\"][namespace])) {\n  TAPi18n.translations[\"de\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"de\"][namespace], {\"translation_key\":\"translation string\"});\nTAPi18n._registerServerTranslator(\"de\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"el\"])) {\n  TAPi18n.translations[\"el\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"el\"][namespace])) {\n  TAPi18n.translations[\"el\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"el\"][namespace], {});\nTAPi18n._registerServerTranslator(\"el\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n// integrate the fallback language translations \ntranslations = {};\ntranslations[namespace] = {\"translation_key\":\"translation string\"};\nTAPi18n._loadLangFileObject(\"en\", translations);\nTAPi18n._registerServerTranslator(\"en\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"es\"])) {\n  TAPi18n.translations[\"es\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"es\"][namespace])) {\n  TAPi18n.translations[\"es\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"es\"][namespace], {});\nTAPi18n._registerServerTranslator(\"es\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"et\"])) {\n  TAPi18n.translations[\"et\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"et\"][namespace])) {\n  TAPi18n.translations[\"et\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"et\"][namespace], {\"translation_key\":\"t√µlkimise string\"});\nTAPi18n._registerServerTranslator(\"et\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"fr\"])) {\n  TAPi18n.translations[\"fr\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"fr\"][namespace])) {\n  TAPi18n.translations[\"fr\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"fr\"][namespace], {\"translation_key\":\"traduire une cha√Æne de caract√®res\"});\nTAPi18n._registerServerTranslator(\"fr\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"hu\"])) {\n  TAPi18n.translations[\"hu\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"hu\"][namespace])) {\n  TAPi18n.translations[\"hu\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"hu\"][namespace], {});\nTAPi18n._registerServerTranslator(\"hu\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"id\"])) {\n  TAPi18n.translations[\"id\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"id\"][namespace])) {\n  TAPi18n.translations[\"id\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"id\"][namespace], {\"translation_key\":\"translation string\"});\nTAPi18n._registerServerTranslator(\"id\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"it\"])) {\n  TAPi18n.translations[\"it\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"it\"][namespace])) {\n  TAPi18n.translations[\"it\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"it\"][namespace], {\"translation_key\":\"translation string\"});\nTAPi18n._registerServerTranslator(\"it\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"ja\"])) {\n  TAPi18n.translations[\"ja\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"ja\"][namespace])) {\n  TAPi18n.translations[\"ja\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"ja\"][namespace], {});\nTAPi18n._registerServerTranslator(\"ja\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"kk\"])) {\n  TAPi18n.translations[\"kk\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"kk\"][namespace])) {\n  TAPi18n.translations[\"kk\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"kk\"][namespace], {\"translation_key\":\"–∞—É–¥–∞—Ä–º–∞ —Ç–µ–∫—Å—Ç\"});\nTAPi18n._registerServerTranslator(\"kk\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"ko\"])) {\n  TAPi18n.translations[\"ko\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"ko\"][namespace])) {\n  TAPi18n.translations[\"ko\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"ko\"][namespace], {\"translation_key\":\"Î≤àÏó≠ Î¨∏ÏûêÏó¥\"});\nTAPi18n._registerServerTranslator(\"ko\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"nl\"])) {\n  TAPi18n.translations[\"nl\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"nl\"][namespace])) {\n  TAPi18n.translations[\"nl\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"nl\"][namespace], {});\nTAPi18n._registerServerTranslator(\"nl\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"pl\"])) {\n  TAPi18n.translations[\"pl\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"pl\"][namespace])) {\n  TAPi18n.translations[\"pl\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"pl\"][namespace], {\"translation_key\":\"translation string\"});\nTAPi18n._registerServerTranslator(\"pl\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"pt-BR\"])) {\n  TAPi18n.translations[\"pt-BR\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"pt-BR\"][namespace])) {\n  TAPi18n.translations[\"pt-BR\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"pt-BR\"][namespace], {\"translation_key\":\"chave de tradu√ß√£o\"});\nTAPi18n._registerServerTranslator(\"pt-BR\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"ro\"])) {\n  TAPi18n.translations[\"ro\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"ro\"][namespace])) {\n  TAPi18n.translations[\"ro\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"ro\"][namespace], {});\nTAPi18n._registerServerTranslator(\"ro\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"ru\"])) {\n  TAPi18n.translations[\"ru\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"ru\"][namespace])) {\n  TAPi18n.translations[\"ru\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"ru\"][namespace], {});\nTAPi18n._registerServerTranslator(\"ru\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"sl\"])) {\n  TAPi18n.translations[\"sl\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"sl\"][namespace])) {\n  TAPi18n.translations[\"sl\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"sl\"][namespace], {\"translation_key\":\"preveden niz\"});\nTAPi18n._registerServerTranslator(\"sl\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"sv\"])) {\n  TAPi18n.translations[\"sv\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"sv\"][namespace])) {\n  TAPi18n.translations[\"sv\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"sv\"][namespace], {\"translation_key\":\"√∂vers√§ttningstext\"});\nTAPi18n._registerServerTranslator(\"sv\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"th\"])) {\n  TAPi18n.translations[\"th\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"th\"][namespace])) {\n  TAPi18n.translations[\"th\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"th\"][namespace], {});\nTAPi18n._registerServerTranslator(\"th\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"tr\"])) {\n  TAPi18n.translations[\"tr\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"tr\"][namespace])) {\n  TAPi18n.translations[\"tr\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"tr\"][namespace], {\"translation_key\":\"√ßeviri dizesi\"});\nTAPi18n._registerServerTranslator(\"tr\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"vi\"])) {\n  TAPi18n.translations[\"vi\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"vi\"][namespace])) {\n  TAPi18n.translations[\"vi\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"vi\"][namespace], {});\nTAPi18n._registerServerTranslator(\"vi\", namespace);\n","var _ = Package.underscore._,\n    package_name = \"telescope:invites\",\n    namespace = \"telescope:invites\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nif(_.isUndefined(TAPi18n.translations[\"zh-CN\"])) {\n  TAPi18n.translations[\"zh-CN\"] = {};\n}\n\nif(_.isUndefined(TAPi18n.translations[\"zh-CN\"][namespace])) {\n  TAPi18n.translations[\"zh-CN\"][namespace] = {};\n}\n\n_.extend(TAPi18n.translations[\"zh-CN\"][namespace], {\"translation_key\":\"translation string\"});\nTAPi18n._registerServerTranslator(\"zh-CN\", namespace);\n"]}